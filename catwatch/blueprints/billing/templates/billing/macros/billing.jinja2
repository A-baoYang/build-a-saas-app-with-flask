{% macro plan(plan, last=False) -%}
  <div
      class="g--third{{ ' g--last' if last }} login--background{{ ' scale-up' if plan.metadata and plan.metadata.recommended }} {{ ' half-faded' if (plan.metadata == undefined) or (plan.metadata and not plan.metadata.recommended) }}">
    <h3 class="text-divider{{ ' color--blue' if plan.metadata and plan.metadata.recommended }}">{{ plan.name }}</h3>
    {{ caller () }}
    {% if current_user.is_authenticated() %}
      {% if current_user.subscription %}
        {% if plan == active_plan %}
          <strong class="button--secondary pricing--secondary">Current
            plan</strong>
        {% else %}
          <button id="submit_{{ plan.id }}" name="submit_{{ plan.id }}"
             class="button--primary pricing--primary">
            <img src="{{ asset_url_for('images/spinner.gif') }}"
                 class="spinner"
                 width="16" height="11" alt="Spinner"/>
            Change plan</button>
        {% endif %}
      {% else %}
        <a href="{{ url_for('billing.create', plan=plan.id) }}"
           class="button--primary pricing--primary">Continue</a>
      {% endif %}
    {% else %}
      <a href="{{ url_for('user.signup') }}"
         class="button--primary pricing--primary">Sign up</a>
    {% endif %}

    <p class="small color--muted">${{ plan.amount | format_currency }}
      / {{ plan.interval }}</p>
  </div>
{%- endmacro %}

{% macro coupon_data(coupon) -%}
  {% if coupon.amount_off %}
    {% set discount = '$' + coupon.amount_off | format_currency %}
  {% else %}
    {% set discount = coupon.percent_off | string + '%' %}
  {% endif %}
  {% if coupon.duration == 'forever' %}
    {% set label = 'It is saving you ' + discount + ' per month forever.' %}
  {% elif coupon.duration == 'once' %}
    {% set label = 'It saved you ' + discount + ' this month.' %}
  {% else %}
    {% set label = 'It is saving you ' + discount + ' for the next ' + coupon.duration_in_months | string + ' months.' %}
  {% endif %}

  {{ label }}
{%- endmacro %}

{% macro coupon_duration_tag_for(coupon) -%}
  {% if coupon.duration == 'forever' %}
    <span class="alert--interesting alert--small">Forever</span>
  {% elif coupon.duration == 'once' %}
    <span class="alert--warn alert--small">Once</span>
  {% else %}
    <span class="alert--info alert--small">
      {{ coupon.duration_in_months }} months
    </span>
  {% endif %}
{% endmacro %}

{% macro coupon_expiration(coupon) -%}
  {% if coupon.redeem_by %}
    {{ coupon.redeem_by.strftime('%B %d, %Y %I:%M %p') }}
  {% elif coupon.duration_in_months %}
    &mdash;
  {% else %}
    Never
  {% endif %}
{% endmacro %}

{% macro coupon_redeemed(times_redeemed, max_redemptions) -%}
  {% set total = max_redemptions if max_redemptions else '&infin;' %}
  {{ times_redeemed }} / {{ total }}
{% endmacro %}

{% macro coupon_discount(amount_off, percent_off) -%}
  {% if amount_off %}
    ${{ amount_off | format_currency }}
  {% else %}
    {{ percent_off }}%
  {% endif %}
{% endmacro %}

